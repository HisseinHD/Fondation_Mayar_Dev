<div class="gestion-candidats-container">
    <h2>Gestion des candidats</h2>

    <div class="filtres">
        <input type="text" placeholder="Filtrer par nom" [(ngModel)]="filtreNom">

        <select [(ngModel)]="filtreFormation">
            <option value="">Toutes les formations</option>
            <option *ngFor="let f of formations" [value]="f._id">
                {{ f.titre }}
            </option>
        </select>
    </div>

    <div *ngIf="loading" class="loading">Chargement…</div>
    <div *ngIf="errorMessage" class="error">{{ errorMessage }}</div>

    <table *ngIf="!loading && filtrerCandidats().length > 0">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Prénom</th>
                <th>Email</th>
                <th>Téléphone</th>
                <th>Niveau</th>
                <th>Formation</th>
                <th>Date inscription</th>
                <th>Actions</th>
                <th>Statut</th>
            </tr>
        </thead>

        <tbody>
            <tr *ngFor="let c of filtrerCandidats()">
                <td>{{ c.nom }}</td>
                <td>{{ c.prenom }}</td>
                <td>{{ c.email }}</td>
                <td>{{ c.tel }}</td>
                <td>{{ c.niveau || 'Non spécifié' }}</td>
                <td>{{ c.formation?.titre || 'N/A' }}</td>
                <td>{{ c.dateInscription | date:'short' }}</td>

                <td>
                    <button class="edit" (click)="ouvrirModal(c)">Éditer</button>
                    <button class="delete" (click)="supprimerCandidat(c._id)">Supprimer</button>
                </td>

                <td>
                    <select [(ngModel)]="c.statut" (change)="modifierStatut(c, c.statut!)">
                        <option value="en attente">En attente</option>
                        <option value="validé">Validé</option>
                        <option value="refusé">Refusé</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>

    <p *ngIf="!loading && filtrerCandidats().length === 0">
        Aucun candidat trouvé.
    </p>
</div>

<div class="modal-backdrop" *ngIf="showModal">
    <div class="modal-content">
        <h3>Éditer le candidat</h3>

        <label>Nom</label>
        <input type="text" [(ngModel)]="candidatEdit.nom">

        <label>Prénom</label>
        <input type="text" [(ngModel)]="candidatEdit.prenom">

        <label>Email</label>
        <input type="email" [(ngModel)]="candidatEdit.email">

        <label>Téléphone</label>
        <input type="text" [(ngModel)]="candidatEdit.tel">

        <label>Niveau</label>
        <input type="text" [(ngModel)]="candidatEdit.niveau">

        <label>Formation</label>
        <select [(ngModel)]="candidatEdit.formation._id">
            <option *ngFor="let f of formations" [value]="f._id">
                {{ f.titre }}
            </option>
        </select>

        <div class="modal-actions">
            <button class="save" (click)="sauvegarderEdition()">Sauvegarder</button>
            <button class="close" (click)="fermerModal()">Fermer</button>
        </div>
    </div>
</div>